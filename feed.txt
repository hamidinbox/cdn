<?php


header( 'Content-Type: ' . feed_content_type( 'rss2' ) . '; charset=' . get_option( 'blog_charset' ), true );
$more = 1;

echo '<?xml version="1.0" encoding="' . get_option( 'blog_charset' ) . '"?' . '>';

do_action( 'rss_tag_pre', 'rss2' );

echo '<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	'.do_action( 'rss2_ns' ).'
>

<channel>
	<title>'.wp_title_rss().'</title>
	<atom:link href="'.self_link().'" rel="self" type="application/rss+xml" />
	<link>'.bloginfo_rss( 'url' ).'</link>
	<description>'.bloginfo_rss( 'description' ).'</description>
	<lastBuildDate>'.get_feed_build_date( 'r' );.'</lastBuildDate>
	<language>'.bloginfo_rss( 'language' ).'</language>
	<sy:updatePeriod>'.apply_filters( 'rss_update_period', 'hourly' ).'</sy:updatePeriod>
	<sy:updateFrequency>'.apply_filters( 'rss_update_frequency', '1' ).'</sy:updateFrequency>
	'.do_action( 'rss2_head' );
  
	while ( have_posts() ){
		the_post();
echo '<item>
		<title>'.the_title_rss().'</title>
		<link>'.the_permalink_rss().'</link>';
    
		if ( get_comments_number() || comments_open() ){
evho '<comments>'.comments_link_feed().'</comments>';
  }

echo '<dc:creator><![CDATA['.the_author().']]></dc:creator>
		<pubDate>'.mysql2date( 'D, d M Y H:i:s +0000', get_post_time( 'Y-m-d H:i:s', true ), false ).'</pubDate>
		'.the_category_rss( 'rss2' ).'
		<guid isPermaLink="false">'.the_guid().'</guid>';

		if ( get_option( 'rss_use_excerpt' ) ){
echo '<description><![CDATA['.the_excerpt_rss().']]></description>';
		} else {
echo '<description><![CDATA['.the_excerpt_rss().']]></description>';
			$content = get_the_content_feed( 'rss2' );
			if ( strlen( $content ) > 0 ){
			echo '<content:encoded><![CDATA['.$content.']]></content:encoded>';
			} else {
			echo '<content:encoded><![CDATA['.the_excerpt_rss().']]></content:encoded>';
      }
		}

		if ( get_comments_number() || comments_open() ){
		echo '<wfw:commentRss>'.esc_url( get_post_comments_feed_link( null, 'rss2' ) ).'</wfw:commentRss>
			<slash:comments>'.get_comments_number().'</slash:comments>
		}

		rss_enclosure();
		do_action( 'rss2_item' );
	echo '</item>';
	}
echo '</channel>
</rss>';

?>
